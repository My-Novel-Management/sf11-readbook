# -*- coding: utf-8 -*-
"""Episode: 1.滅びた世界
"""
import os
import sys
sys.path.append(os.path.join(os.path.dirname(__file__), '../..'))
sys.path.append('storybuilder')
from storybuilder.builder.world import World
from storybuilder.builder.writer import Writer


## defines
W = Writer
_ = W.getWho()

## scenes
def sc_perished_world(w: World):
    yuri, kudo = W(w.yuri), W(w.kudo)
    outside = W(w.outside)
    return w.scene("滅びた世界で",
            w.symbol("　　　　１"),
            yuri.come(),
            kudo.come(),
            yuri.do("アスファルトの割れ目から伸びた樹木の根が放射状に広がり、緑のグラデーションを作る苔がそれらを装飾していた",
                "口元をナノ繊維のマフラーで覆った小柄な男性は、その根元に出来た小さな水たまりを超えようと僅かに屈伸し、跳ぶ", "&"),
            _.do("しかし見事な着水でブーツの上まで濁ったものが飛び上がり、彼はマフラーに失意の吐息をぶつけた"),
            kudo.talk("ユーリィ", "何故無理をしたのか？"),
            yuri.do("ブーツの足を水たまりから出した彼を嘲笑うかのように合成音声で淡々と尋ねた相棒は、その四肢を広げて木の根に立ち、",
                "ひょい、と効果音を付けたくなる軽快さで水たまりを飛び越えていく", "$Sの一メートル先に着地して「どうだい」とばかりに振り返った", "&"),
            _.do("かつて犬と呼ばれていた動物に似せて作られた、金属製の自律機械（ドローン）だ",
                "その白銀の頭部に付いた二つのメインカメラが鈍く緑に光り、彼を見ている"),
            yuri.talk("クド、できると思ったことが偶然失敗しただけで、それを無理と呼ぶのは勘弁して欲しい"),
            kudo.talk("偶然というものはない", "確率は常にパーセントで表現される"),
            yuri.do("相変わらずの物言いに、$Sは彼を見つめて二秒静止し、それからゆっくりと首を振った"),
            yuri.talk("確かに成功する確率を高く見積もりすぎたとは思うが、それについて議論する為に貴重な$energyを消費するつもりはないよ",
                "そもそも$kudoはちょっと細かすぎるんだ",
                "いくらこの$w_archiver（アーカイバ）が正確なデータを求められる仕事とはいえ、常にそれが必要とされている訳じゃないんだよ？"),
            _.do("$Sは言い聞かせるように彼を見たが、しゅっと伸びた鼻筋もピンと立ったままの耳も瞼のない目も、何の変化も示さない",
                "いつだって彼は無表情だ", "当初はそういった機能は記録用ドローンには必要ないと判断されていたのだろう"),
            yuri.talk("それよりそろそろ今日の寝床を探したい"),
            _.do("見上げた空はグレィの筋状の雲が幾層にも重なり、日差しはない", "&"),
            _.think("$Sにとって空といえばこんな風に分厚い雲で塞がれているか、夜闇によって漆黒で塗りつぶされているかのどちらかでしかなかった", "&"),
            _.do("地上に出たからには一度くらいは青空というものを拝んでみたいと思っているがまだその機会は訪れない",
                "おそらく今後もないと予測されるが、楽観的観測をするならば「いつかは見られる」と$Sは考えている"),
            yuri.talk("$kudo"),
            _.do("記録用犬型ドローンの名を呼び、$Sは改めて、もう使えなくなったアスファルトの片側二車線を見やった",
                "道路脇にはかつて鉄筋コンクリートのビルが立ち並んでいたと思われるが、その一割程度しか残骸がない",
                "多くが基礎部分のみ残存し、一階、あるいは二階まで残っていれば良い方だ", "&"),
            outside.look("おそらくはこの街のメインストリートだったと考えられる",
                "それでも今は見渡しても人や犬のような小動物も、自動車やバイクといった他の移動機械も、その姿を見つけられない",
                "いや、天井が崩れ落ちて細い鉄筋が剥き出しになったその建物の、窓枠の下だ",
                "白く細い棒状の物が固まっていた", "既に歳月を経て表面に草が生え、筋組織や神経といったものは残っていないようだ",
                "$Sは生体反応のないそれを見送り、$kudoに尋ねる"),
            yuri.talk("問い合わせの成果は？"),
            kudo.do("彼に訊かれ、今一度犬型ドローンは空を見上げた",
                "ぐるぐるとガス雲が回っている", "そこから時折不純物を含んだ雨が落ちてきたが、幸いにもユーリィの防護ジャケットを溶かすほどの酸性はない",
                "相棒のドローンの特殊コーティングがその銀色の体表に雨粒を浮かせ、そのうちの数滴が流れ落ちた",
                "$kudoは小さく首を振り彼を見る"),
            kudo.talk("衛星との通信状況が悪い", "まだ未着パケットが大量にある状態だ"),
            yuri.talk("それは終わっていない、ということだよ", "既に記録済みなら今日はもう休みたい"),
            kudo.talk("$yuri", "君は勤勉な$w_archiverとして$w_cemargurからも表彰されたことがある", "その名誉を誇りに思うべきだ"),
            yuri.do("名誉という言葉に何のメリットも感じない$Sは文句の多い犬型ドローンを置いて、先に歩いていく"),
            yuri.do("盛り上がった道路を超えた先、その陰の部分に「ＴＡＫＳＩ」と書かれたプレートを乗せた黄色い自動車があった",
                "五十年以上前にはまだ現役でこの地球上を走っていたというのだが、おそらく化石燃料が必要なはずだから手入れしたところでもう走れないだろう"),
            yuri.talk("バッテリィくらいなら残っているかな？"),
            _.do("半分冗談のつもりで$kudoに言ったが、彼は小さく頷くと三センチほど隙間が開いていたフロント部分に前足を器用に突っ込んで開け、中を覗き込む"),
            kudo.talk("盗難に遭っている"),
            yuri.do("抑揚がない所為か不機嫌に聞こえたけれど、$kudoは特に気にせず顔を引き抜くと$Sの左側へと戻ってくる"),
            yuri.talk("残念だったね"),
            kudo.talk("残念というのはそれなりに期待が見込めた場合に使う言葉で、$meはあそこにバッテリィが残存し、かつ、それによって充電可能な確率は限りなくゼロに近いと見積もっていたから――"),
            yuri.talk("ああもう！", "分かった分かった",
                "$meもどうせ無いだろうと思ってたけど、今の残念は、あったら嬉しいのにねという気休めの言葉だよ",
                "でも会話ってそういうものだろう？"),
            kudo.do("$kudoは軽く十五度ほど首を傾げただけで、関心がないとばかりに歩いていく"),
            yuri.talk("必要ないと判断したことは一切口を開かないその姿勢、$meは嫌いじゃないよ", "$meはね"),
            _.do("それでも何も答えない犬型ドローンの背中を見て小さく首を竦めると、$Sは彼の後に続いた"),
            camera=w.yuri,
            area=w.Jakarta,
            stage=w.on_street,
            day=w.in_visittown, time=w.at_afternoon,
            )

def sc_old_school(w: World):
    yuri, kudo = W(w.yuri), W(w.kudo)
    return w.scene("壊れた学校",
            w.symbol("　　　　２"),
            yuri.come(),
            kudo.come(),
            yuri.talk("$kudo、学校だよ"),
            kudo.talk("何故わざわざ口に出す？　$meのカメラには問題が発生していないから、見れば分かる"),
            yuri.do("二時間ほど壊れた街を歩き回り、坂道を上った先にその大きなコンクリートの建物を見つけた",
                "$kudoの方が$Sよりずっと遠方の物体を視認できたが、",
                "辛うじて残った校門跡と思しき柱まで歩いてくると、そこの金属プレートにハイスクールという文字が刻まれているのが分かった",
                "中を見やれば草や木で覆われてはいるが校庭だったと思われる広い庭を取り囲むようにしてコンクリートの三階建てが二棟、存在しているのが確認できる"),
            yuri.talk("とりあえず調べてみよう", "これまでのデータから何か役に立つものが残っている可能性が高い、だろ？"),
            kudo.do("$kudoは何も言い返さずに一つ頷き、先に歩いていく"),
            yuri.talk("次のアップデートで冗談を理解する機能を付けてもらいたいと要望しておいてくれないかな"),
            kudo.talk("了解した"),
            yuri.talk("そこはスルーするのが正解だと思うんだ"),
            yuri.do("何故？　という視線を向けて立ち止まった$kudoの脇を、小さく首を振りながら追い抜いていく",
                "発声せずにやり取りできればもう少しドローンとの交流もスムーズなのかなと思ったが、",
                "常にいつもの小言を聞かされることを想像すると、それも勘弁だなと$Sは溜息をついた"),
            yuri.do("生徒用と思われる玄関前までやってくる", "外壁こそ部分的に破損、剥離しているものの、建物の大きな歪みや傾きは計測できない",
                "$kudoは鼻先を壁や柱、割れた窓等に向け、安全を確認する",
                "彼のセンサは安全性を評価したようで、$Sに小さく頷くと、先行して屋内に入っていく"),
            yuri.think("建物の多くは半壊から全壊し、そのままの状態で長い時間が経過していることもあり、ちょっとした振動で崩れてしまうことがままあった",
                "$Sが$w_archiverとして調査を始めた頃には幾度となく$kudoの警告を無視して先行し、危なく壁に押しつぶされるといった経験をしたが、",
                "最近は調査規則を守り、必ず$kudoによって安全性が確認されてから侵入するようにしていた"),
            yuri.talk("学校、という制度が昔はどこでも機能していたんだっけ"),
            kudo.talk("必要なら資料を取り寄せるが？"),
            yuri.do("窓ガラスは全て割れてしまっていた",
                "その為か、廊下の隅には土が堆積し、日の入る箇所には植物が葉を広げている",
                "壁や天井に蔦が這い、苔で覆われてもいた"),
            yuri.talk("一度資料で読んだし、何ならいつも読んでいる小説の中にはそういった舞台を扱ったものもあるから、何となくの理解はしているよ"),
            kudo.talk("何となく、は六十％程度のことか？"),
            yuri.talk("何となくは何となくだよ",
                "同じ服を着て同じ部屋に集まり、同じ学習を行う",
                "そういった不便さをよく当時の人たちは享受していたものだね"),
            yuri.think("自分と同じ年代の、他人たちと勉強の為に生活を共にする",
                "そのメリットが$Sにはよく理解できなかった",
                "それは$w_archiverという孤独な仕事が日常となっている故に集団生活とは無縁だからか、",
                "フィクションの中で描かれているような友情や恋愛といった感情にあまり関心がない所為だろうか"),
            kudo.do("$Sは何か言おうとしたが咄嗟に$CSが先に行くよう促したから黙ったまま、教室の一つに入った"),
            yuri.do("同じ木製の天板にスチールの曲がった脚が付いた椅子や机が重なって壁に固められている",
                "人為的に綺麗に並べたものではなく、水流のような圧倒的な$energyにより一箇所にまとめられたものだ",
                "窓は全てガラスが無く、カーテンは大きく裂けて苔が繁殖していた",
                "振り返ると深緑の板が前側の壁に貼り付けられているのに気づき、それは「黒板」と呼ばれるものだと$kudoが言った"),
            yuri.do("あれが起こる前、そこには何が書いてあったのか", "今は推測することすら難しい",
                "白く曇ったような汚れと、貼り付いた泥、蜘蛛の巣が張り、そこに文字を書く為のチョークは一本として存在しない"),
            _.do("調べてみたが特に使えそうなものはなく、$kudoと共に廊下へと出る"),
            _.do("同じようにどの教室も役立ちそうなものは残っていなかったが、職員用の小さな部屋には窓がなかったお陰だろうか、",
                "パイプ製の簡易ベッドが固くなったマットレスと共に見つかった"),
            yuri.talk("久々に屋内で休めそうだよ、$kudo"),
            _.do("上に乗って強度を確かめながらそう言うと、クロゼットの中身を確認していた$kudoは一度顔を$Sに向け、"),
            kudo.talk("二週間前に教会で、一週間には漂着していたバスの中で仮眠を取った"),
            yuri.do("と訂正した"),
            w.br(),
            yuri.do("屋上に出ると大量に太陽光パネルが整列していた"),
            yuri.talk("ねえ$kudo、こいつらは使えるの？"),
            kudo.do("確認してみる、と返事をした犬型ドローンはパネルから基部に繋がったコードや計器類を調べていたが、すぐに首を横に振る",
                    "バッテリィの存在は確認できなかったのだ",
                    "それでも一応全てを調べてみると一割程度のパネルで辛うじて発電システムそのものは生き残っていた", "&"),
            _.do("ただそれらがどんなに高性能であったとしても向こう百年は発電することは叶わない",
                "そう推定されている", "$CSは当時の状況をデータでしか知らないが、完全防護服と暗視ゴーグルなしに外を出歩けるようになったのがこの五年程と言われていた"),
            kudo.talk("自家発電機構が存在する可能性を希望する"),
            _.do("そう言って屋上の縁まで行くと彼は首をぐるりと動かして周辺状況を観測した",
                    "赤外線センサで不審な熱源でも感知できれば、そこに生命活動がある可能性も生まれる",
                    "ただ$Sの場合は電源に類するものが存在していることを願ってやっているのだろう"),
            kudo.talk("省エネモードに移行した方が良い"),
            yuri.talk("何だい$kudo", "もう$energy切れかい？", "最近燃費性能が落ちているんじゃない？"),
            _.do("自分の方を見た犬型ドローンは既にモードを変更したようで、目の発光が青色に変化して薄くなり、何も言わずにドアへと歩いて向かう"),
            yuri.think("仕方ないな",
                    "そう独りごちると、$Sは彼に続く", "&"),
            yuri.do("ゴーグルに時刻を呼び出すと、標準時間で午前九時と表示された"),
            yuri.talk("$kudo"),
            yuri.do("思わず声を掛け、現在地での時刻への変換を頼もうとしたが彼は既にドアを開けて階段を降り始めており、",
                    "仕方なく変換プログラムを利用して今がここの夕方なのだと知った",
                    "けれど空を見上げても変化のないグレィの分厚い雲が覆い、時折紫の稲光が縦横に走っているのが確認できるだけだった"),
            w.br(),
            yuri.do("寝床は職員宿直用の部屋を利用することにして、$Sは他に生きている設備がないか$kudoと手分けして探した"),
            _.do("人はいない", "住んでいる動物もいない", "&"),
            _.do("水道や電気は当然通じていないし、非常食の蓄えも見つけられなかった"),
            _.do("だからといって落胆はない",
                    "$w_archiverにとっては何もないのが日常だからだ", "本部に連絡を取り、定期的に空輸ドローンで補給を受ける",
                    "そうやってこれまで$Sたちは活動を続けてきた"),
            yuri.talk("$kudoはどうするの？"),
            yuri.do("しばらくの間この学校をベースキャンプとすることに決め、宿直室に戻ってくる",
                    "$kudoは何も答えずにパイプベッドの下で四肢を横たえて目のライトを完全に消した",
                    "寝る、ということは犬型ドローンに必要ないが、無駄な$energy消費を抑える為に活動が難しくなる夜の時間帯にはスリープモードにして大人しくしておくのだ",
                    "予備バッテリィを携帯しているものの、いつそれが必要になるとも分からない",
                    "無駄遣いを抑えることも$w_archiverの大事な務めだった"),
            yuri.talk("拗ねた訳じゃないって分かってるけど、返事すらないのは流石に味気ないね"),
            _.do("$Sはベッドに座り、バックパックから一日分のカロリーと栄養素を固めた歯が折れそうなスティックを取り出す",
                    "味はない", "必要最低限の$energy補給用で音を立てて齧りながらゴーグルに小説を呼び出した",
                    "文章のみで構成されたメディアというのは軽量でストレージに入れて持ち運ぶにちょうど良い",
                "最近はかつて古典と呼ばれていた時代の小説をよく読む", "今日はジュール・ベルヌにでもしようかと作家リストを開いた"),
            stage=w.on_highschool,
            time=w.at_evening,
            )

## episode
def ep_ghostworld(w: World):
    return w.episode("滅びた世界",
            # add scenes
            sc_perished_world(w),
            sc_old_school(w),
            note="1.滅びた世界で記録士をやっているユーリィは、犬型ドローンと共に街の調査に訪れる",
            )
