# -*- coding: utf-8 -*-
"""Episode: 2.古い図書館
"""
import os
import sys
sys.path.append(os.path.join(os.path.dirname(__file__), '../..'))
sys.path.append('storybuilder')
from storybuilder.builder.world import World


## scenes
def sc_library_lady(w: World):
    yuri, kudo, jas = w.get("yuri"), w.get("kudo"), w.get("jas")
    return w.scene("図書館の女性",
            w.cmd.change_stage("library"),
            w.cmd.change_date("visittown"),
            w.cmd.change_time("evening"),
            w.symbol("　　　　３"),
            yuri.come(),
            kudo.come(),
            yuri.do("翌朝、僅かに空に明るさが戻ったのを確認して、$Sたちは再び屋上へと出た",
                "雲は相変わらず晴れないものの、時折こうしてぼんやりと明るくなる", "以前はこれでも曇りと呼ばれたそうだ"),
            yuri.talk("ねえ、あれ"),
            yuri.do("相変わらず$kudoは答えずに顔だけ向けたが、$Sは指で山の方を差して望遠機能で確認してもらう",
                "麓のところに頑丈そうな二階建てが見えたからだ"),
            kudo.talk("ライブラリィ、つまり図書館のようだ"),
            yuri.talk("記録士にはおあつらえ向きだね"),
            yuri.do("やっと「ああ」とだけ返事をした$kudoと共に学校を出ると、悪路を歩いてその建物へと向かった",
                "この世界では整備された道路はどこにもないし、踏み込んだ一歩の地面が崩れない保証もない"),
            yuri.do("校門だった場所を出て一キロほどひび割れた坂道を進んだところで、巨大な穴が開いていた"),
            yuri.talk("$kudo、お願い"),
            yuri.do("君はまたそうやって無駄なエネエルギィを使わせるつもりか、等と文句を言うかと思ったが、",
                "$kudoは渋々といった様子で背中を向けて首を下げた",
                "「ありがとう」と伝えてその背に跨る",
                "穴は目測で五メートルほどだが底は見えない",
                "助走をつければ何とか飛べるかも知れないけれど向こう側の地面の強度が不明だ",
                "こういう時は素直に$kudoに頼る"),
            yuri.do("前足を屈め、力を溜めると、$kudoは一気に穴を飛び越えた"),
            yuri.do("彼に「助かった」と告げ、その背を降りて坂道の続きを歩く",
                "ほどなくして、図書館らしい建物の前に広がる駐車場が見えてきた"),
            yuri.talk("これは……残念だ"),
            kudo.talk("同意する"),
            yuri.do("屋上からは無事に見えたのに図書館という看板が立てられていたその建物の玄関の右側から後ろに掛けて大きく崩れていた"),
            yuri.talk("中は無事だと良いけど"),
            kudo.talk("その可能性は高くない"),
            yuri.talk("そういう時は低いと言うんだよ"),
            yuri.do("何か間違っているのか、と無言の視線を投げかけた$kudoに先に内部の安全を確認するよう促し、",
                "彼に続いて$Sはガラスが蜘蛛の巣状に割れた分厚い玄関ドアを潜った"),
            yuri.do("中は二階までの吹き抜け構造になっていて、天井には薄っすらと宗教画のようなものが残っている",
                "大きなホールの右手側に書架が並んでいたがやはりそちら側は壁が崩れて多くの棚が押し倒されたままの状態だ",
                "構造として採光の為の窓の数を減らし、かつ小さく造ってあったのは感心するが、壁の強度に問題があったのだろう",
                "ゴーグルを暗視モードに切り替え、$Sは足元に注意しながら奥へと進んだ"),
            yuri.do("書架として使われているのは木製の棚ではなかった",
                "一見するとスチールのそれかと思ったがどうやら樹脂で出来ているらしい", "かつてプラスチックと呼ばれていたものの中で中程度の性能のものだ",
                "当時は風化に強いと考えられたのだろうが、実際風雨に晒されると黴も繁殖し、微生物の餌ともなり、多くが変色して歪んでいた",
                "そこに所蔵されていた本は言うまでもなく当然紙が原料であり、",
                "棚同様、風雨に晒されて劣化した挙句、虫による侵食で外観のみを残して中身は空洞化してしまっていた"),
            yuri.talk("参ったね"),
            yuri.do("手に取るのが躊躇われたがそれでも一冊くらいは、",
                "と分厚いハードカバーの装丁本を引き抜いてみた", "途端、砂になった中身が落下して床に小さな山を作る"),
            yuri.talk("$kudo、ここに本が現存している確率は？"),
            kudo.talk("０．０１％程度あれば良い"),
            yuri.talk("そういう時は望み薄だ、と言ってくれ"),
            yuri.do("それでも本物の書籍を拝みたいという、記録士としての真っ当な気持ちで全ての本棚を調べて回ったが、残念ながらこの施設はもう図書館として名乗るべき所蔵品を持っていないことが判明しただけだった"),
            yuri.talk("クド、０％だ"),
            yuri.do("そう言ってやったが、犬型ドローンは頑なに「ゼロではない」と言い張る"),
            yuri.do("その僅かばかりの可能性を求めて壁が崩れているギリギリの箇所まで丁寧に調べて回ったが、水こそ引いているものの、どの本も本としての体裁を死守できていなかった",
                    "全滅だ、と$Sは溜息を落とす"),
            yuri.do("諦めて入り口の方に向かった時だった"),
            yuri.talk("良いガラスケースがあるよ、$kudo"),
            kudo.talk("素材はアクリル樹脂と推定"),
            yuri.do("入る時に見落としていたようだ",
                "瓦礫の陰に隠れて展示用のケースが一台、倒れていた"),
            yuri.do("その中に五冊の本を見つけたが、",
                "ケースから飛び出ていた四冊は腐食していた",
                "唯一ケースの中に留まっていた一冊だけが無事なように見えた"),
            yuri.talk("押収するよ、クド。記録"),
            kudo.talk("了解した"),
            yuri.do("時刻と押収物を犬型ドローンに記録させる"),
            yuri.do("開いたケースの隙間に手を入れ、かつてペーパーバックと呼ばれていたものだろう、片手で持てる程度のサイズの本を、取った"),
            jas.talk("その本を、借りられますか？"),
            yuri.do("振り返ると、眼鏡の女性が立っていた",
                "言語は英語でもドイツ語でもロシア語ですらない"),
            yuri.do("$Sは$kudoを見たが、その間に言語特定が終わったようで、彼女が自分にこの本のレンタルを尋ねたのだと理解した"),
            yuri.do("女性は$Sとは違いかなり軽装で、脛が見える程度の長さの赤やオレンジで編み込まれたワンピースに合皮の袖なしベストを着ていた",
                "肌はミルクチョコレートのようで、後ろでまとめられた髪は艶があり黒い"),
            jas.talk("ところで、当館ではペットの持ち込みは禁じられていますので、申し訳ないのですがそちらの……"),
            yuri.talk("$kudoです",
                "クドリャフカというのですが長いので$kudoと省略しています", "彼はあまり気に入っていないようです"),
            jas.talk("$kudoさんは、外に括り付けておいていただけませんか？"),
            yuri.do("犬が怖い、というのではないのだろうが、彼女はまじまじと犬型ドローンを見下ろしている"),
            yuri.talk("彼はペットではなく、記録用のドローンなんです"),
            jas.talk("ドローン？"),
            yuri.do("ああ、と$Sは理解する", "それとも、やはり、という思いだろうか"),
            yuri.talk("ロボット、いえ、色々と便利な機械です", "見た目が犬の形をしているだけで"),
            jas.talk("ロボットは分かります", "なら、危険はないのですね"),
            yuri.talk("ええ。大丈夫です", "あなたに襲いかかることは決してありません",
                "それよりもこの本はとても貴重な物です", "$meらはそういったものを集めて記録、保管するのが仕事なんです", "だから、持っていっても良いでしょうか"),
            yuri.do("彼女は首を振る"),
            jas.talk("そちらの本には先約があります", "その方に貸し出した後でしたら、あなたにお貸しすることも可能ですけど"),
            yuri.do("困った、という表情を$Sは$kudoに向けたが、彼は「コードが優先される」と短く告げた"),
            yuri.explain("コード、というものの存在が、$Sたち記録士にとっては絶対だった",
                "それは彼らの業務についての規定であり、彼らを縛り付けているルールでもあり、彼らそのものとも言えた",
                "そこには『現地に人間がいた場合、彼らの言うことを受け入れる必要がある。しかし人間でない場合においてはこの限りでない』と記されている"),
            yuri.do("彼女の輪郭が、戸惑いがちに動く度に微かな発光現象を起こす"),
            yuri.talk("その方というのはいつ来られるんですか？"),
            yuri.do("質問を返した$Sに$kudoは小さく頭を振った"),
            jas.talk("明日、帰ってこられますよ。この地球に"),
            yuri.talk("というと、どこか遠い場所に？"),
            jas.talk("はい。彼はこの国を代表する宇宙飛行士です", "$exfull_andreと言います"),
            jas.explain("彼女によれば$exfull_andreなる人物は一年前に別の国にある打ち上げ基地からロケットで月に向かい、そこに建造されたステーションで様々な任務を十二ヶ月間こなした後、ここに戻ってくるらしい"),
            yuri.talk("分かりました。ではまた明日、訪ねてみます"),
            jas.talk("すみません"),
            yuri.talk("いえ。先約があるのでしたら仕方ない。そうだ。お名前を教えていただけますか？"),
            jas.talk("$exfull_andreです"),
            yuri.talk("いえ、あなたの"),
            jas.talk("$me、ですか？　$meは……$jas。$exfull_jasです"),
            yuri.talk("$meは$exfull_yuri", "$yuriと気軽に呼んで下さい。それでは"),
            )

## episode
def ep_old_library(w: World):
    return w.episode("古い図書館",
            # add scenes
            sc_library_lady(w),
            outline="2.古い図書館には貴重な本が残っていた。しかし司書を名乗る電磁幽霊の女性が現れて、本は予約済みだと言う",
            )
