# -*- coding: utf-8 -*-
"""Episode: 3.待ち続ける女性
"""
import os
import sys
sys.path.append(os.path.join(os.path.dirname(__file__), '../..'))
sys.path.append('storybuilder')
from storybuilder.builder.world import World
from storybuilder.builder.writer import Writer


## defines
W = Writer
_ = W.getWho()

## scenes
def sc_satellite_line(w: World):
    yuri, kudo, jas = W(w.yuri), W(w.kudo), W(w.jas)
    return w.scene("衛星回線",
            w.symbol("　　　　４"),
            yuri.be(),
            kudo.be(),
            yuri.explain("図書館を出た後は主に学校の周辺を調査して歩いた",
                "やや高台になった場所だった為か、建物の倒壊はメインストリートと比べるとかなり少なく、",
                "公共の建物の割合が高い",
                "それでも多くが強盗や野生の獣に入り込まれて荒らされた形跡があり、保存食や水の備蓄、簡易テントに寝袋、毛布、椅子といったものは軒並み存在しなかった"),
            _.do("それらに対し、いちいち「押収物なし」と$kudoに記録させる",
                "$w_archiverの仕事の大半はこの世界に生きているものがいないことと使えそうなものは残っていないことを確認する作業だった"),
            yuri.talk("ねえ$kudoはどう思う？"),
            yuri.do("学校に戻ってきた$Sは、屋上で衛星通信の続きを試みるという$kudoに図書館で出会った女性について意見を求める",
                "どうすべきか、という判断は全て$w_archiverである$Sが行わなければならない", "記録用ドローンはあくまで記録のみがその任務だった"),
            kudo.talk("主語と述語しかない", "目的語を要求する"),
            yuri.talk("そこはほらさ、何となく今までの会話の流れから隠された内容を汲み取るということをしてだね"),
            yuri.do("夜空、と呼べるものはこの世界に存在しない",
                "暗視モードでも何も見えず、ライトを当てれば雲が渦を成しているのが多少視認できるくらいだ",
                "月明かりなど望むべくもなかった"),
            yuri.talk("まあいいよ", "明日になれば問題解決しているかも知れないし"),
            kudo.talk("図書館の件については最終的な判断はコードによる"),
            yuri.talk("$meたち$w_archiverが何よりコードを重視すべきなのは耳にタコだよ",
                "でもね結局コードは単なる規則でしかないから運用する$meらが悩むしかないんだよ",
                "そのこと分かってるの？"),
            yuri.do("$kudoは通信を始めたのか、三十度ほど鼻先を空へと向け、目の光がゆっくり点滅する"),
            yuri.talk("いつも肝心なところで役に立たないな、$kudoは"),
            yuri.do("何も答えない彼を置いて、$Sは屋上を立ち去る"),
            yuri.do("一階の宿直室に入ると、バックパックを足元に置き、簡易ベッドの上に寝転がる",
                "スプリングは機能しておらずマットレスも薄くてまるで板の上に横たわるようだったが、",
                "それでも地べたで摂る睡眠に比べると隔絶の寝心地だ"),
            _.do("天井を見上げ、ゴーグルに小説を呼び出そうとして、$Sはそれを止めた", "彼女のことが気になったからだ"),
            _.do("彼女は幽霊、あるいは霊的現象と呼ばれる存在だった", "図書館を出てすぐに$kudoに解析してもらったからそれは間違いない",
                "ああいったものはかつて非科学的で超常現象等と呼ばれていたけれど、現在では霊というものは偶発的な自然回路現象であると定義され『$w_ghost』と名付けられている",
                "人の思念、それが空間に漂う塵やイオンとの間で電気信号回路を形成し、何かのきっかけでそこに人間がいるように観測者が捉えてしまう",
                "観測者自身もその自然回路現象に関与しているから、誰もが同じように見たり聞いたり話したりできる訳ではないが、$Sだけでなく$kudoも捉えていることから、",
                "彼女はそれなりに強い自然回路現象だと認められた"),
            _.do("このような現象に今まで何度か遭遇したことはあったが、それでも$jasのようにはっきりとした輪郭と反応を持っているものは珍しかった"),
            w.br(),
            kudo.talk("$yuri、おはよう"),
            yuri.do("久しぶりに寝過ごしたらしい"),
            _.do("目を開けると$kudoがベッドの上で膝を抱えている彼を覗き込んでいた"),
            _.talk("ああ、失態だ", "ところで通信は終わった？"),
            kudo.do("$Sは小さく頷いてから、問い合わせ結果について報告をする"),
            yuri.talk("それじゃあこの街はまだ未登録区域なんだね"),
            kudo.talk("ああ。君の仕事が期待される"),
            yuri.do("抑揚のない合成音声はいつ聞いても期待のきの字も感じられない"),
            yuri.talk("それで$exfull_andreについては？"),
            kudo.talk("一応宇宙飛行士、あるいは月面基地のスタッフに名前がないか検索を掛けてみたが、ノーヒットだった"),
            yuri.think("――彼女は嘘をついたのだろうか"),
            yuri.do("それが真実かどうかは、今日訪れてみれば判明するだろう", "ただこれまでの報告では$w_ghostが嘘をついたという事例は上がっていない"),
            camera=w.yuri,
            stage=w.on_highschool,
            time=w.at_night,
            )

def sc_mosque_and_flower(w: World):
    yuri, kudo, jas = W(w.yuri), W(w.kudo), W(w.jas)
    return w.scene("モスクと花",
            w.symbol("　　　　５"),
            yuri.do("図書館を訪れるのは後回しにして$Sは$kudoと共に他の生き残っていそうな施設を見て回ることにした"),
            _.do("何もかもが息絶えた、と云われている『$w_walpurgis』を超えた現在、それでもまだ僅かな人類は生き延びていた",
                "ただ彼らは汚染された外気には触れられず、地下シェルターでひっそりと暮らしている",
                "$w_archiverの仕事は変貌してしまった地表の状態を観察しデータとして本部に送ることで、やがて再び人類が地上で暮らせる下準備を整えることだ、とコードには記載されていた"),
            _.do("学校から五キロくらい離れた場所に真っ白な建物があった", "家ではない"),
            kudo.talk("モスク、と呼ばれるものだ"),
            _.do("$kudoが答える"),
            yuri.do("尖塔はなく、礼拝用の部屋と体を清める為の個室や倉庫が設けられているだけの、質素なものだった", "壁や天井の装飾もない",
                "$Sはライブラリで見た聖堂のようなものと違い、もっと生活感が滲む建物だな、と感じた",
                "当時は毎日五度、ここに近隣の住民が集まり礼拝をしていたのだろう"),
            yuri.think("――こういった公共施設を核シェルター構造にでもしておけば、もっと沢山の人間が生き延びられたのだろうか"),
            _.do("そんなイフ（もしも）をよく考える"),
            kudo.talk("$yuri。それは質問か？"),
            yuri.do("どうやら声に出してしまっていたらしい"),
            yuri.talk("ただの独り言だよ", "それにしても、どうして昔の人々はこんなにも神を信じていたんだろうね"),
            kudo.talk("神学、あるいは哲学から幾つか引用しようか？"),
            yuri.talk("いいよ。それは面倒そうだ",
                "$kudoはもっと気を回すといった精神構造のアップデートが必要じゃないかな"),
            _.do("だが犬型ドローンはそれには何も答えず、記録の為に施設内を歩き回る"),
            _.do("一分も見れば全てに目を通せるような質素な空間だった", "予想通りだ"),
            yuri.talk("何もない"),
            _.do("$yuri以外の$w_archiverの大半が、その一言を記入する",
                "この世界では人が作ったものは現在機能しているものを除いてほぼ失われてしまっていた",
                "代わりにかつて「自然」と呼んでいたその一部である植物や昆虫類が探す必要がないほどに増えてしまっている"),
            yuri.talk("収穫はなしっと"),
            _.do("入り口に戻ると、先に出た$kudoが盛り上がったアスファルトの上でこちらを振り返っていた", "さっさと次の場所を調査しようというつもりだろう"),
            yuri.talk("ねえ$kudo。この花は何という名前だろう"),
            yuri.do("それは建物の裏手に造られていた", "煉瓦で囲った中から植物が溢れるように茎や葉を伸ばしていた",
                "$Sが注目したのはその中で一輪だけ咲いている、小さな白い花だ",
                "鬱蒼と伸びる緑の中で星のような五枚の花弁を持つそれはあの図書館に唯一残る彼女の姿のようでもあった"),
            kudo.talk("記録した", "後で問い合わせる"),
            _.do("戻ってきた$kudoは目を向けて撮影すると、いつまでもそこを立ち去ろうとしない$CSに改めてその視線を向ける"),
            kudo.talk("どうした？"),
            yuri.talk("名前が登録されていない場合は$meが付けても良いんだったよね？"),
            kudo.talk("コードにはそう書いてある"),
            yuri.explain("$w_archiverのもう一つの仕事", "それが命名だった", "おそらくこの街も彼が名付けることになる",
                "ただその街に特徴的なものがなかった時にはいつものように適当な数字とアルファベットの組み合わせを選ぶことになるだろう",
                "$Sは自分以外が既に名付けた街を偶然訪れ、そこに付いた味気ない記号のようなそれを$kudoから聞かされた時に思わず「その程度なら$w_archiverが付ける必要はない」と言ってしまった"),
            yuri.think("それについて特に$kudoは何も言わなかったが、あの時の感情の昂りは何だったのだろうかと今も時々考える"),
            stage=w.on_mosque,
            time=w.at_midmorning,
            )

def sc_herwork(w: World):
    yuri, kudo, jas = W(w.yuri), W(w.kudo), W(w.jas)
    return w.scene("彼女の仕事",
            w.symbol("　　　　６"),
            yuri.do("現地の時刻で夕方に近い頃合いだった"),
            yuri.do("学校の備品倉庫を発見し、そこにあった自家発電機を動かしてみるという$kudoと分かれ、",
                "$Sは再び図書館を訪れていた",
                "玄関まで歩いてきたところで瓦礫で埋もた表示板を見つけ、この図書館の利用時間が十八時までだと知った",
                "あと一時間もすれば彼女と会えなくなるかも知れない",
                "ただ$w_ghostは不安定な存在で、既に消失している可能性も考慮しつつ$Sは玄関を潜った"),
            jas.talk("$yuriさん、ですね"),
            yuri.do("入ってすぐ正面で、眼鏡の彼女は立っていた"),
            yuri.talk("ええ、はい"),
            _.do("自分の名前を口にしたことに多少驚きはあったが、昨日会話したことで回路に若干の影響があったのだろうと納得させる",
                "大部分の$w_ghostは同じ言動を繰り返す機能しか持たない、とレポートには上がっていた"),
            yuri.talk("あの、$exfull_andreさんは本を借りに来ましたか？"),
            yuri.do("スカートの前で両手を合わせた彼女は$Sの言葉が理解できなかったのか、じっと前を見たまま黙り込んでいる",
                "現地語への翻訳が上手くいっていないのだろうかと思い、再度丁寧に発音して変換を試みた"),
            jas.talk("ああ、$exfull_andreさんですね",
                "彼はまだ帰ってきていません",
                "明日にならないと地球に戻ってこないんです"),
            yuri.do("昨日も”明日”と言われたが彼女の中ではまだその明日が来ていないのだろう",
                "$w_ghostにはよくそういったことが起こった",
                "というよりも時間という概念から逸脱していると言った方が良いかも知れない",
                "ここは多少強引な手段を使ってでも貴重な現存する最後かも知れない本を手に入れるべきか逡巡するが、",
                "会釈をして書架の方へと向かった彼女を見て、その考えの採用を一旦見送る"),
            yuri.talk("あの、すみません"),
            jas.talk("何でしょうか"),
            _.do("彼女は振り返ることなく本棚が本来立っていた場所で指差しをしながら何かの確認をしている"),
            yuri.talk("こちらの図書館について、少し教えてもらえますか？"),
            jas.talk("図書館について、ですか？"),
            yuri.talk("はい"),
            jas.do("彼女は作業を中止して$CSの方を向き、顎に人差し指を当てて少し考え込む素振りを見せると、"),
            jas.talk("何についてお調べしましょうか", "知りたい方のお力になるのが、$meたち司書の仕事です"),
            jas.do("そう言って微笑み掛けた"),
            stage=w.on_library,
            time=w.at_afternoon,
            )

def sc_lookupmoon(w: World):
    yuri, kudo, jas = W(w.yuri), W(w.kudo), W(w.jas)
    return w.scene("月を見上げて",
            w.symbol("　　　　７"),
            yuri.do("その日も高校のベッドで夜を過ごした"),
            kudo.do("$kudoはバッテリィがもったいないからとまだ省エネモードのまま、屋上で今日も衛星通信を試みている",
                "ただ大半の衛星が機能停止してただのデブリになりはて、僅かに送受信可能なものは分厚い雲の隙間を通すような微弱な電波の交流しか行えないらしい"),
            yuri.talk("雨、か"),
            yuri.explain("季節というものが無くなっても雨は降る", "けれどその雨粒は酸性が強く、地表に出ているものの腐食を早めた",
                "$Sたちの装備はコーティングがされているがそれでも一月毎に新しいものに取り替える必要がある"),
            yuri.talk("残念だったね"),
            yuri.do("部屋に入ってきた$kudoは本物の犬のようにぶるっと身体を震わせ、表面に付着した水滴を飛ばす",
                "何か言うかと思ったが特に言葉もなくベッドの下まで歩いてくると、体を沈めてそこで睡眠モードに切り替わった"),
            yuri.talk("$kudoも植物のように光や水でエネルギィを生成できるように造られていれば良かったのにね"),
            kudo.talk("雨は残念だ", "その意見には同意する"),
            yuri.talk("何だい", "別に答えてくれなくても良かったのに"),
            yuri.do("それでも少しだけ気分の落ち着きを感じて、$Sはゴーグルに小説を呼び出す",
                "明日には$jasのことで決断をしなければならないかも知れないと思うと、できるだけ内省的ではない冒険活劇や探偵小説を読みたくなった"),
            w.br(),
            yuri.do("だがその翌日は一日雨で、無理をすれば調査ができない訳でもなかったが基本的に酸性雨の中で動き回るのは流石の$kudoも勧めない",
                "二、三の言葉のやり取りの後で$Sは結局無駄なエネルギィ消費を抑えることを選択した"),
            _.do("そんな時、彼以外の$w_archiverがどういった過ごし方をしているのか知らないが、$Sは必要な資料を読み込むか、",
                "$kudoに記録してもらった映像を見直して調査レポートの下書きをするか、", "好きな小説を読むかぐらいしか選択肢を持っていなかった"),
            _.do("最初はゴーグルに今後の環境浄化予測の資料を呼び出して眺めていたが、一時間もすれば飽きて、結局いつも通り小説を開いた",
                "寝転びながら視線の動きでページを捲る",
                "かつてはこれをわざわざ指を使い、紙に印刷されたものを一枚一枚次に送っていたのだというから驚きだ",
                "その上、デジタルデータなら何百冊分を軽々と持ち歩くことができるが、本という形態だとせいぜい十冊が良いところだった",
                "「そんな文明だから滅びたんだ」とこのゴーグルを開発した人間は言っていたけれど、彼女はページを捲る音をわざわざこの機能に追加している",
                "その件について尋ねると「風情というものよ」と興味なさそうに答えた"),
            _.do("手持ちのライブラリにはカフカやカミュ、ヘッセといったヨーロッパの作家から、トルストイ、ドストエフスキーといったロシアの文豪の名も並ぶ",
                "ごく稀に日本という国の作家のものも読んでみるのだが言語翻訳機能に支障があるようで、上手く日本語が訳せずに珍妙な言い回しになってしまうことが難点だった"),
            stage=w.on_library,
            time=w.at_evening,
            )

def sc_hermind(w: World):
    yuri, kudo, jas = W(w.yuri), W(w.kudo), W(w.jas)
    return w.scene("彼女の気持ち",
            w.symbol("　　　　８"),
            yuri.be(),
            _.talk("今日は一人で行ってくるよ"),
            _.do("翌日、$Sは$kudoを置いて単独で図書館に向かった",
                "彼は特に何も言わなかったが、原則として$w_archiverと記録用ドローンは行動を共にしなければならない",
                "おそらく無駄なエネルギィを消費することになる、と判断したのだろう", "コードを守れと口うるさい割りにはそういうところはちゃっかりしていた"),
            _.do("雨露が地面や割れた路面の上で生え散らかした草木に付着し、何度か足を取られそうになる",
                "途中にあった大きな裂け目は渡れるように電柱の折れたものを持ってきて渡れるようにしておいた",
                "コードにこそ書かれていないがあまり調査地のものを動かしたり破壊することは好まれない",
                "それでも扉や壁を破らなければ中を調べられなかったり、時にはそのままにしておくことで危険性が勝ったりするので、",
                "現場判断で多少の破壊行為は認められていた"),
            _.do("中はびしょ濡れだろうか、という予測と共に訪れた図書館の玄関までやってくると、中は意外と雨の被害が少ないように見える",
                "風の角度で崩れている側はあまり吹き込まないのかも知れない"),
            jas.talk("$yuriさん", "おはようございます"),
            yuri.talk("ああ、おはよう、と言うんだったね"),
            _.do("誰かと出会った時に午前の時間帯であればそう声を掛け合うのだという知識は持っていた",
                "玄関ホールの正面で同じように$Sを待っていた彼女は、その輪郭を僅かにぶれさせながらも微笑を浮かべている"),
            yuri.talk("彼は本を借りに来ますかね"),
            jas.talk("彼というのは$exfull_andreさんのことですか？"),
            yuri.do("それに頷くと予想通り彼女は昨日と同じ説明をする", "彼女にとって彼は永遠に帰ってこない存在なのだろう"),
            _.talk("待っているんですね、彼のこと", "$exfull_andreさんはどんな方なんですか？"),
            jas.talk("どんな……"),
            yuri.do("そこで彼女は目を何度も瞬かせ、それから少しだけ眉間に皺を作る"),
            yuri.talk("宇宙飛行士というのは聞きました", "国を代表する立派な方だとも"),
            jas.talk("ええ、そうです",
                "$exfull_andreさんは貧しい家庭で育ち、学校もまともに行けない中で、こちらの図書館を利用して独学で沢山の知識を修められました",
                "国の支援制度を利用して大学に進み、学位を取得し、この国で初めての宇宙飛行士になられたのです"),
            _.do("彼女は淀みなく語る",
                "まるでよく練習し、何度も他人に対して同じ文言を伝えたかのように"),
            jas.talk("この本は、あの人の為に取ってあるんです", "あの人は本をとても好きでした"),
            yuri.talk("$meも本は好きです", "小説はよく読みます", "可能なら沢山の本に囲まれて生活できればと思いますよ"),
            _.do("見渡した書架はどれも倒れ、朽ち、そこに僅かに残る本だったものたちも中身はない",
                "本はどの現場でも腐敗、腐食、破壊されてしまっていた"),
            jas.talk("本は、宝物だと思います", "本に書かれているのは物語だけではありません", "そこには様々な人の思いが溢れているんです"),
            _.do("彼女はそう言って何かを思い出すように虚空を見る"),
            yuri.talk("分かりました", "もう一日待ちます"),
            jas.talk("すみません"),
            yuri.do("建物を出た彼は空を見上げた", "分厚いガス雲の、更に向こう側だ"),
            _.do("そこにはもう、月面基地は存在しない", "十年も前に砕け、その大半はこの大地へと降り注いだのだ", "当時の映像記録はライブラリで一度見たが、正にこの世の終わりと呼ぶに相応しい映像だった"),
            yuri.talk("本には思いが溢れている、か……"),
            stage=w.on_library,
            time=w.at_midmorning,
            )

## episode
def ep_waiting_girl(w: World):
    return w.episode("待ち続ける女性",
            # add scenes
            sc_satellite_line(w),
            sc_mosque_and_flower(w),
            sc_herwork(w),
            sc_lookupmoon(w),
            sc_hermind(w),
            note="3.いつまで待っても本を借りに男はやってこない。ユーリィは街を調査し、ある情報を手に入れた",
            )
